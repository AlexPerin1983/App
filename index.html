<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>CarFilm-Pro</title>

    <!-- Meta tag para responsividade -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <!-- Framework CSS para facilitar o design responsivo -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Font Awesome para ícones -->
    <!-- Biblioteca de ícones para utilizar nos botões e menus -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

     <!-- Link para o CSS externo -->
     <link rel="stylesheet" href="styles.css">

</head>
<body>

    <!-- Cabeçalho -->
    <div class="header">
        <!-- Botão para abrir/fechar a barra lateral em dispositivos móveis -->
        <span class="toggle-menu" onclick="toggleSidebar()"><i class="fas fa-bars"></i></span>

        <!-- Logo e nome da empresa -->
        <span class="logo" id="logoEmpresaHeader">
            <!-- O logotipo e o nome da empresa serão inseridos aqui via JavaScript -->
            <img src="https://via.placeholder.com/40" alt="Logo da Empresa">
            <span id="nomeEmpresaHeader">CarFilm-Pro</span>
        </span>

        <!-- Informações da empresa (CNPJ/CPF) exibidas se cadastradas -->
        <div class="company-info" id="companyInfoHeader">
            <span id="cnpjEmpresaHeader"></span>
        </div>
    </div>

    <!-- Barra lateral (menu) -->
    <div class="sidebar" id="sidebar">
        <!-- Informações do usuário no menu lateral para dispositivos móveis -->
        <div class="user-info d-md-none">
            <img src="https://via.placeholder.com/80" alt="Logo da Empresa" id="logoEmpresaSidebar">
            <div class="user-name" id="nomeEmpresaSidebar">CarFilm-Pro</div>
            <div class="user-cnpj" id="cnpjEmpresaSidebar"></div>
        </div>

        <!-- Menu de navegação -->
        <!-- Cada item chama a função showSection com o ID da seção correspondente -->
        <div class="menu-item" onclick="showSection('inicio')"><i class="fas fa-home"></i> Inicio</div>
        <div class="menu-item" onclick="showSection('empresa')"><i class="fas fa-building"></i> Minha Empresa</div>
        <div class="menu-item" onclick="showSection('clientes')"><i class="fas fa-users"></i> Clientes</div>
        <div class="menu-item" onclick="showSection('peliculas')"><i class="fas fa-film"></i> Películas</div>
        <div class="menu-item" onclick="showSection('veiculo')"><i class="fas fa-car"></i> Veículos</div>
        <div class="menu-item" onclick="showSection('servicos')"><i class="fas fa-tools"></i> Serviços</div>
        <div class="menu-item" onclick="showSection('agendamento')"><i class="fas fa-calendar-alt"></i> Agendamentos</div>
        <div class="menu-item" onclick="showSection('pagamentos')"><i class="fas fa-credit-card"></i> Formas de Pagamentos</div>
        <div class="menu-item" onclick="showSection('orcamento')"><i class="fas fa-file-invoice-dollar"></i> Orçamento</div>
        <div class="menu-item" onclick="showSection('fornecedores')"><i class="fas fa-truck-loading"></i> Fornecedores</div>
        <div class="menu-item" onclick="showSection('estoque')"><i class="fas fa-boxes"></i> Estoque</div>
    </div>

    <!-- Overlay para dispositivos móveis (fica sobre o conteúdo quando o menu está aberto) -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Conteúdo principal carregado inicialmente -->
    <div class="main-content" id="mainContent">
        <!-- Seção "Inicio" (ativa por padrão) -->
        <div id="inicio" class="content-section active">
            <div class="container-fluid">
                <h2>Inicio</h2>
                <p>Aqui você pode gerenciar os serviços oferecidos pela sua empresa.</p>
                <!-- Você pode adicionar mais conteúdo aqui -->
            </div>
        </div>

        <!-- Seção "Minha Empresa" -->
        <div id="empresa" class="content-section">
            <div class="container-fluid">
                <h2>Dados da Empresa</h2>
                <!-- Formulário de Dados da Empresa -->
                <form id="formEmpresa">
                    <!-- Campo para upload do logotipo -->
                    <div class="form-group">
                        <label for="logoEmpresa">Logotipo da Empresa</label>
                        <input type="file" class="form-control-file" id="logoEmpresa" accept="image/*">
                        <small class="form-text text-muted">Escolha uma imagem para representar sua empresa.</small>
                        <!-- Pré-visualização do logotipo -->
                        <div id="previewLogo" style="margin-top: 10px;">
                            <img src="" alt="Pré-visualização do Logotipo" style="max-height: 100px;">
                        </div>
                    </div>
                    <!-- Demais campos do formulário -->
                    <div class="form-group">
                        <label for="nomeEmpresa">Nome da Empresa</label>
                        <input type="text" class="form-control" id="nomeEmpresa" placeholder="Digite o nome da empresa" required>
                    </div>
                    <div class="form-group">
                        <label for="cnpjEmpresa">CNPJ</label>
                        <input type="text" class="form-control" id="cnpjEmpresa" placeholder="00.000.000/0000-00">
                    </div>
                    <div class="form-group">
                        <label for="cpfEmpresa">CPF (caso não tenha CNPJ)</label>
                        <input type="text" class="form-control" id="cpfEmpresa" placeholder="000.000.000-00">
                    </div>
                    <div class="form-group">
                        <label for="whatsappEmpresa">WhatsApp</label>
                        <input type="text" class="form-control" id="whatsappEmpresa" placeholder="(00) 00000-0000" required>
                    </div>
                    <div class="form-group">
                        <label for="emailEmpresa">E-mail</label>
                        <input type="email" class="form-control" id="emailEmpresa" placeholder="email@empresa.com" required>
                    </div>
                    <div class="form-group">
                        <label for="cepEmpresa">CEP</label>
                        <input type="text" class="form-control" id="cepEmpresa" placeholder="00000-000" required>
                    </div>
                    <div class="form-group">
                        <label for="cidadeEmpresa">Cidade</label>
                        <input type="text" class="form-control" id="cidadeEmpresa" required>
                    </div>
                    <div class="form-group">
                        <label for="bairroEmpresa">Bairro</label>
                        <input type="text" class="form-control" id="bairroEmpresa" required>
                    </div>
                    <div class="form-group">
                        <label for="ruaEmpresa">Rua</label>
                        <input type="text" class="form-control" id="ruaEmpresa" required>
                    </div>
                    <div class="form-group">
                        <label for="numeroEmpresa">Número</label>
                        <input type="text" class="form-control" id="numeroEmpresa" required>
                    </div>
                    <!-- Paleta de Cores -->
                    <div class="form-group">
                        <label>Paleta de Cores</label>
                        <div class="color-palette">
                            <!-- Cores predefinidas -->
                            <div class="color-swatch" style="background-color: #0D6EFD;" data-color="#0D6EFD"></div>
                            <div class="color-swatch" style="background-color: #198754;" data-color="#198754"></div>
                            <div class="color-swatch" style="background-color: #DC3545;" data-color="#DC3545"></div>
                            <div class="color-swatch" style="background-color: #FFC107;" data-color="#FFC107"></div>
                            <div class="color-swatch" style="background-color: #6C757D;" data-color="#6C757D"></div>
                            <!-- Adicione mais cores se desejar -->
                        </div>
                    </div>
                    <!-- Botão para salvar os dados da empresa -->
                    <button type="button" class="btn btn-primary" onclick="salvarEmpresa()">Salvar</button>
                </form>
            </div>
        </div>

        <!-- Seção "Clientes" -->
<div id="clientes" class="content-section">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Clientes</h2>
            <button class="btn btn-primary" onclick="abrirModalCliente()">
                <i class="fas fa-plus"></i> Novo Cliente
            </button>
        </div>

        <!-- Tabela de Clientes -->
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>CPF/CNPJ</th>
                        <th>Telefone</th>
                        <th>Email</th>
                        <th>Endereço</th>
                        <th>Empresa</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tabelaClientes">
                    <!-- Os clientes serão inseridos aqui via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

     <!-- Modal para Cadastro/Edição de Cliente -->
     <div class="modal fade" id="modalCliente" tabindex="-1" aria-labelledby="modalClienteLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalClienteLabel">Novo Cliente</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formCliente">
                        <input type="hidden" id="clienteId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="nomeCliente">Nome*</label>
                                    <input type="text" class="form-control" id="nomeCliente" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="cpfCnpjCliente">CPF/CNPJ*</label>
                                    <input type="text" class="form-control" id="cpfCnpjCliente" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="telefoneCliente">Telefone*</label>
                                    <input type="text" class="form-control" id="telefoneCliente" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="emailCliente">Email</label>
                                    <input type="email" class="form-control" id="emailCliente">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="empresaCliente">Empresa</label>
                                    <input type="text" class="form-control" id="empresaCliente">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="cepCliente">CEP</label>
                                    <input type="text" class="form-control" id="cepCliente">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="enderecoCliente">Endereço</label>
                                    <input type="text" class="form-control" id="enderecoCliente">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="numeroCliente">Número</label>
                                    <input type="text" class="form-control" id="numeroCliente">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="complementoCliente">Complemento</label>
                                    <input type="text" class="form-control" id="complementoCliente">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="bairroCliente">Bairro</label>
                                    <input type="text" class="form-control" id="bairroCliente">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="cidadeCliente">Cidade</label>
                                    <input type="text" class="form-control" id="cidadeCliente">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="estadoCliente">Estado</label>
                                    <input type="text" class="form-control" id="estadoCliente">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- Atualização do footer do modal -->
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
    <button type="submit" class="btn btn-primary" form="formCliente">Salvar</button>
</div>
            </div>
        </div>
    </div>
</div>

   <!-- Seção "Películas" -->
<div id="peliculas" class="content-section">
    <div class="container-fluid">
        <h2>Películas</h2>
        <p>Aqui você pode gerenciar as películas disponíveis.</p>
        
        <!-- Cards das Categorias -->
        <div class="row" id="categoriasContainer">
            <!-- Cards serão inseridos aqui via JavaScript -->
        </div>

<!-- Modal para Cadastrar/Editar Película -->
<div class="modal fade" id="modalCadastrarFilme" tabindex="-1" aria-labelledby="modalCadastrarFilmeLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="formCadastrarFilme">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCadastrarFilmeLabel">Cadastrar Película</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
              <input type="hidden" id="filmeId"> <!-- Campo oculto para o ID da película -->
              <input type="hidden" id="categoriaSelecionada">
              <div class="form-group">
                  <label for="nomeFilme">Nome</label>
                  <input type="text" class="form-control" id="nomeFilme" placeholder="Digite o nome da película" required>
              </div>
              <div class="form-group">
                  <label for="marcaFilme">Marca da Película</label>
                  <input type="text" class="form-control" id="marcaFilme" placeholder="Digite a marca da película" required>
              </div>
              <div class="form-group">
                  <label for="descricaoFilme">Descrição</label>
                  <textarea class="form-control" id="descricaoFilme" rows="3" placeholder="Digite a descrição da película" required></textarea>
              </div>
              <div class="form-group">
                  <label for="precoFabricante">Preço Fabricante (R$)</label>
                  <input type="number" step="0.01" class="form-control" id="precoFabricante" placeholder="Digite o preço do fabricante" required>
              </div>
              <div class="form-group">
                  <label for="precoMaoObra">Preço Mão de Obra (R$)</label>
                  <input type="number" step="0.01" class="form-control" id="precoMaoObra" placeholder="Digite o preço da mão de obra" required>
              </div>
              <div class="form-group">
                  <label for="quantidadeEstoque">Quantidade em Estoque (m)</label>
                  <input type="number" step="0.01" class="form-control" id="quantidadeEstoque" placeholder="Digite a quantidade em estoque" required>
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Salvar Película</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div> <!-- Falta fechar o container-fluid -->
</div> 
  
  
  
        
<!-- Modal para Exibir Lista de Películas por Categoria -->
<div class="modal fade" id="modalListaFilmes" tabindex="-1" aria-labelledby="modalListaFilmesLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl"> <!-- Tamanho maior para melhor visualização -->
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalListaFilmesLabel">Películas da Categoria</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="container-fluid">
                <div class="row" id="listaFilmesCategoria">
                    <!-- Cards serão inseridos aqui via JavaScript -->
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>
  



        <!-- Seção "Veículos" -->
        <div id="veiculo" class="content-section">
            <div class="container-fluid">
                <h2>Veículos</h2>
                <p>Aqui você pode gerenciar os veículos.</p>
                <!-- Conteúdo da seção "Veículos" -->
            </div>
        </div>

<!-- Seção "Serviços" -->
<div id="servicos" class="content-section">
    <div class="container-fluid">
        <!-- Cabeçalho da seção -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Serviços</h2>
        </div>

        <!-- Cards dos tipos de serviços -->
        <div class="row">
            <!-- Card PPF (Paint Protection Film) -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header text-center bg-primary text-white">
                        <i class="fas fa-shield-alt fa-3x mb-2"></i>
                        <h5 class="card-title">PPF - Paint Protection Film</h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <p class="text-muted">Proteção de Pintura Automotiva</p>
                        </div>
                        <div class="d-flex flex-column">
                            <button class="btn btn-primary mb-2" onclick="abrirModalAdicionarServico('ppf')">
                                <i class="fas fa-plus mr-2"></i>
                                Adicionar Serviço
                            </button>
                            <button class="btn btn-info" onclick="abrirModalListaServicos('ppf')">
                                <i class="fas fa-list mr-2"></i>
                                Ver Serviços (<span class="contador-servicos-ppf">0</span>)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card Envelopamento -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header text-center bg-success text-white">
                        <i class="fas fa-car fa-3x mb-2"></i>
                        <h5 class="card-title">Envelopamento</h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <p class="text-muted">Personalização Automotiva</p>
                        </div>
                        <div class="d-flex flex-column">
                            <button class="btn btn-success mb-2" onclick="abrirModalAdicionarServico('envelopamento')">
                                <i class="fas fa-plus mr-2"></i>
                                Adicionar Serviço
                            </button>
                            <button class="btn btn-info" onclick="abrirModalListaServicos('envelopamento')">
                                <i class="fas fa-list mr-2"></i>
                                Ver Serviços (<span class="contador-servicos-envelopamento">0</span>)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card Window Film -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-header text-center bg-info text-white">
                        <i class="fas fa-window-maximize fa-3x mb-2"></i>
                        <h5 class="card-title">Window Film</h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <p class="text-muted">Películas Automotivas</p>
                        </div>
                        <div class="d-flex flex-column">
                            <button class="btn btn-info mb-2" onclick="abrirModalAdicionarServico('window-film')">
                                <i class="fas fa-plus mr-2"></i>
                                Adicionar Serviço
                            </button>
                            <button class="btn btn-info" onclick="abrirModalListaServicos('window-film')">
                                <i class="fas fa-list mr-2"></i>
                                Ver Serviços (<span class="contador-servicos-window-film">0</span>)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- /.container-fluid -->
</div> <!-- /#servicos -->

<!-- Modal de Serviço (Adicionar/Editar) -->
<div class="modal fade" id="modalServico" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalServicoLabel">Adicionar Serviço</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- O formulário será injetado aqui via JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Modal Lista de Serviços -->
<div class="modal fade" id="modalListaServicos" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalListaServicosLabel">Lista de Serviços</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- A lista será injetada aqui via JavaScript -->
            </div>
        </div>
    </div>
</div>

        <!-- Seção "Agendamentos" -->
        <div id="agendamento" class="content-section">
            <div class="container-fluid">
                <h2>Agendamentos</h2>
                <p>Aqui você pode gerenciar os agendamentos.</p>
                <!-- Conteúdo da seção "Agendamentos" -->
            </div>
        </div>

        <!-- Seção "Formas de Pagamentos" -->
        <div id="pagamentos" class="content-section">
            <div class="container-fluid">
                <h2>Formas de Pagamentos</h2>
                <p>Aqui você pode gerenciar as formas de pagamento.</p>
                <!-- Conteúdo da seção "Formas de Pagamentos" -->
            </div>
        </div>

        <!-- Seção "Orçamento" -->
        <div id="orcamento" class="content-section">
            <div class="container-fluid">
                <h2>Orçamento</h2>
                <p>Aqui você pode criar e gerenciar orçamentos.</p>
                <!-- Conteúdo da seção "Orçamento" -->
            </div>
        </div>

        <!-- Seção "Fornecedores" -->
        <div id="fornecedores" class="content-section">
            <div class="container-fluid">
                <h2>Fornecedores</h2>
                <p>Aqui você pode gerenciar os fornecedores.</p>
                <!-- Conteúdo da seção "Fornecedores" -->
            </div>
        </div>

        <!-- Seção "Estoque" -->
        <div id="estoque" class="content-section">
            <div class="container-fluid">
                <h2>Controle de Estoque</h2>
                <p>Aqui você pode gerenciar o estoque.</p>
                <!-- Conteúdo da seção "Estoque" -->
            </div>
        </div>
    </div>

    <!-- Modais e outros elementos -->
    <!-- Aqui você pode adicionar modais ou outros elementos necessários -->

<!-- Toast de Feedback -->
<div aria-live="polite" aria-atomic="true" style="position: fixed; top: 20px; right: 20px; min-width: 250px;">
    <div class="toast" id="feedbackToast" data-delay="3000">
        <div class="toast-header">
            <strong class="mr-auto" id="toastTitle">Título</strong>
            <small>Agora</small>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Fechar">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="toast-body" id="toastBody">
            Mensagem
        </div>
    </div>
</div>





    <!-- Scripts -->
    <!-- jQuery e Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Inclui Popper.js e Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- IndexedDB Wrapper (Dexie.js) -->
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.0.3/dist/dexie.min.js"></script>
    <!-- Máscaras de input -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

    <!-- Seu script JavaScript personalizado -->
 <!-- Seu script JavaScript personalizado -->
<!-- Seu script JavaScript personalizado -->
<script>
    // Função para mostrar a seção selecionada
    function showSection(sectionId) {
    console.log('Mostrando seção:', sectionId); // Debug
    
    // Remove a classe 'active' de todas as seções
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Adiciona a classe 'active' à seção selecionada
    const selectedSection = document.getElementById(sectionId);
    if (selectedSection) {
        selectedSection.classList.add('active');
        console.log('Seção ativada:', sectionId); // Debug
    }

    // Atualiza o estado dos itens do menu
    document.querySelectorAll('.menu-item').forEach(item => {
        if (item.getAttribute('onclick').includes(sectionId)) {
            item.classList.add('active');
        } else {
            item.classList.remove('active');
        }
    });

    // Fecha a barra lateral em dispositivos móveis
    if (window.innerWidth < 768) {
        document.getElementById('sidebar').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
    }
}

    // Função para alternar a visibilidade da barra lateral em dispositivos móveis
    function toggleSidebar() {
        $('#sidebar').toggleClass('active');
        $('#overlay').toggleClass('active');
    }
// Configuração do IndexedDB usando Dexie.js
var db = new Dexie('CarFilmProDB');

// Definição do schema do banco de dados
db.version(4).stores({
    empresa: 'id,nome,cnpj,cpf,whatsapp,email,cep,cidade,bairro,rua,numero,corTema,logo',
    clientes: '++id,nome,cpfCnpj,telefone,email,empresa,endereco,numero,complemento,bairro,cidade,estado,cep',
    filmes: '++id,nome,descricao,marca,precoFabricante,precoMaoObra,quantidadeEstoque,categoria',
    servicos: '++id,tipo,nome,descricao,preco,observacoes,categoria'
}).upgrade(tx => {
    // Código de migração, se necessário
});

// Em caso de erro na abertura do banco
db.open().catch(error => {
    console.error("Erro ao abrir o banco de dados:", error);
    if (error.name === 'VersionError') {
        // Se houver erro de versão, deleta o banco e recarrega a página
        Dexie.delete('CarFilmProDB').then(() => {
            window.location.reload();
        });
    }
});
    // Variáveis globais e funções para "Minha Empresa"
    var selectedColor = '#0D6EFD'; // Cor padrão
    var logoBase64 = ''; // Armazena a imagem do logotipo em base64

    // Função para salvar os dados da empresa no IndexedDB
    function salvarEmpresa() {
        var cnpj = $('#cnpjEmpresa').val();
        var cpf = $('#cpfEmpresa').val();
        var empresa = {
            id: 1,
            nome: $('#nomeEmpresa').val(),
            cnpj: cnpj,
            cpf: cpf,
            whatsapp: $('#whatsappEmpresa').val(),
            email: $('#emailEmpresa').val(),
            cep: $('#cepEmpresa').val(),
            cidade: $('#cidadeEmpresa').val(),
            bairro: $('#bairroEmpresa').val(),
            rua: $('#ruaEmpresa').val(),
            numero: $('#numeroEmpresa').val(),
            corTema: selectedColor,
            logo: logoBase64
        };
        db.empresa.put(empresa).then(function() {
            mostrarToast('Sucesso', 'Dados da empresa salvos com sucesso!', 'success');
            aplicarCorTema(empresa.corTema);
            atualizarInformacoesEmpresa(empresa);
        }).catch(function(err) {
            console.error(err);
            mostrarToast('Erro', 'Erro ao salvar os dados da empresa.', 'danger');
        });
    }


// Função para formatar o endereço completo
function formatarEndereco(cliente) {
    const partes = [];
    if (cliente.endereco) partes.push(cliente.endereco);
    if (cliente.numero) partes.push(cliente.numero);
    if (cliente.complemento) partes.push(cliente.complemento);
    if (cliente.bairro) partes.push(cliente.bairro);
    if (cliente.cidade) partes.push(cliente.cidade);
    if (cliente.estado) partes.push(cliente.estado);
    if (cliente.cep) partes.push(cliente.cep);
    
    return partes.join(', ') || '-';
}

// Função para abrir o modal de cliente (novo ou edição)
function abrirModalCliente(modo = 'novo') {
    $('#modalClienteLabel').text(modo === 'novo' ? 'Novo Cliente' : 'Editar Cliente');
    $('#formCliente')[0].reset();
    $('#clienteId').val('');
    $('#modalCliente').modal('show');
}


// Função para aplicar a máscara correta no CPF/CNPJ
function aplicarMascaraCpfCnpj(valor) {
    const numeros = valor.replace(/\D/g, '');
    if (numeros.length > 11) {
        return valor.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2}).*/, "$1.$2.$3/$4-$5");
    } else {
        return valor.replace(/^(\d{3})(\d{3})(\d{3})(\d{2}).*/, "$1.$2.$3-$4");
    }
}

// Função para editar cliente
function editarCliente(id) {
    console.log('Editando cliente ID:', id);

    db.clientes.get(parseInt(id)).then(cliente => {
        if (cliente) {
            console.log('Cliente encontrado:', cliente);
            
            // Preenche os campos do formulário
            $('#clienteId').val(cliente.id);
            $('#nomeCliente').val(cliente.nome || '');
            $('#emailCliente').val(cliente.email || '');
            $('#empresaCliente').val(cliente.empresa || '');
            $('#enderecoCliente').val(cliente.endereco || '');
            $('#numeroCliente').val(cliente.numero || '');
            $('#complementoCliente').val(cliente.complemento || '');
            $('#bairroCliente').val(cliente.bairro || '');
            $('#cidadeCliente').val(cliente.cidade || '');
            $('#estadoCliente').val(cliente.estado || '');
            $('#cepCliente').val(cliente.cep || '');

            // Remove máscaras antigas antes de aplicar as novas
            $('#cpfCnpjCliente').unmask();
            $('#telefoneCliente').unmask();
            $('#cepCliente').unmask();

            // Aplica os valores e depois as máscaras
            $('#cpfCnpjCliente').val(cliente.cpfCnpj || '');
            $('#telefoneCliente').val(cliente.telefone || '');
            
            // Reaplica as máscaras
            var options = {
                onKeyPress: function (input, e, field, options) {
                    var masks = ['000.000.000-000', '00.000.000/0000-00'];
                    var mask = (input.length > 14) ? masks[1] : masks[0];
                    $('#cpfCnpjCliente').mask(mask, options);
                }
            };
            
            $('#cpfCnpjCliente').mask('000.000.000-000', options);
            $('#telefoneCliente').mask('(00) 00000-0000');
            $('#cepCliente').mask('00000-000');

            // Força a aplicação da máscara correta baseada no valor atual
            const cpfCnpjAtual = $('#cpfCnpjCliente').val().replace(/\D/g, '');
            if (cpfCnpjAtual.length > 11) {
                $('#cpfCnpjCliente').mask('00.000.000/0000-00');
            } else {
                $('#cpfCnpjCliente').mask('000.000.000-00');
            }

            // Atualiza o título do modal
            $('#modalClienteLabel').text('Editar Cliente');
            
            // Abre o modal
            $('#modalCliente').modal('show');
        } else {
            console.error('Cliente não encontrado com ID:', id);
            mostrarToast('Erro', 'Cliente não encontrado.', 'danger');
        }
    }).catch(error => {
        console.error('Erro ao carregar dados do cliente:', error);
        mostrarToast('Erro', 'Não foi possível carregar os dados do cliente.', 'danger');
    });
}

// Atualização na função de carregar clientes para garantir que o ID está sendo passado corretamente
function carregarClientes() {
    const tbody = document.getElementById('tabelaClientes');
    tbody.innerHTML = '';

    db.clientes.toArray().then(clientes => {
        clientes.forEach(cliente => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${cliente.nome}</td>
                <td>${cliente.cpfCnpj}</td>
                <td>${cliente.telefone}</td>
                <td>${cliente.email || '-'}</td>
                <td>${formatarEndereco(cliente)}</td>
                <td>${cliente.empresa || '-'}</td>
                <td>
                    <button class="btn btn-sm btn-info mr-2" onclick="editarCliente(${cliente.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="excluirCliente(${cliente.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }).catch(error => {
        console.error('Erro ao carregar clientes:', error);
        mostrarToast('Erro', 'Não foi possível carregar a lista de clientes.', 'danger');
    });
}


// Função para excluir cliente
function excluirCliente(id) {
    if (confirm('Tem certeza que deseja excluir este cliente?')) {
        db.clientes.delete(id).then(() => {
            carregarClientes();
            mostrarToast('Sucesso', 'Cliente excluído com sucesso!', 'success');
        }).catch(error => {
            console.error('Erro ao excluir cliente:', error);
            mostrarToast('Erro', 'Não foi possível excluir o cliente.', 'danger');
        });
    }
}



function inicializarComponentesClientes() {
    // Aplicar máscaras nos campos
    $('#telefoneCliente').mask('(00) 00000-0000');
    $('#cepCliente').mask('00000-000');

    // Remover máscaras antigas
    $('#cpfCnpjCliente').unmask();

    // Configurar máscara dinâmica para CPF/CNPJ
    let tipoPessoa = 'CPF';
    
    $('#cpfCnpjCliente').on('keydown', function(e) {
        const digit = e.key;
        if (/^\d$/.test(digit)) {
            const value = this.value.replace(/\D/g, '') + digit;
            if (value.length <= 11) {
                tipoPessoa = 'CPF';
                $(this).mask('000.000.000-00');
            } else {
                tipoPessoa = 'CNPJ';
                $(this).mask('00.000.000/0000-00');
            }
        }
    });

    // Buscar endereço pelo CEP
    $('#cepCliente').on('blur', function() {
        const cep = $(this).val().replace(/\D/g, '');
        if (cep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        $('#enderecoCliente').val(data.logradouro);
                        $('#bairroCliente').val(data.bairro);
                        $('#cidadeCliente').val(data.localidade);
                        $('#estadoCliente').val(data.uf);
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar CEP:', error);
                });
        }
    });

    // Configurar o evento de submissão do formulário
    $('#formCliente').on('submit', async function(event) {
        event.preventDefault();
        event.stopPropagation();
        
        try {
            const clienteId = $('#clienteId').val();
            const cliente = {
                nome: $('#nomeCliente').val(),
                cpfCnpj: $('#cpfCnpjCliente').val(),
                telefone: $('#telefoneCliente').val(),
                email: $('#emailCliente').val(),
                empresa: $('#empresaCliente').val(),
                endereco: $('#enderecoCliente').val(),
                numero: $('#numeroCliente').val(),
                complemento: $('#complementoCliente').val(),
                bairro: $('#bairroCliente').val(),
                cidade: $('#cidadeCliente').val(),
                estado: $('#estadoCliente').val(),
                cep: $('#cepCliente').val()
            };

            // Validação básica
            if (!cliente.nome || !cliente.cpfCnpj || !cliente.telefone) {
                mostrarToast('Erro', 'Por favor, preencha todos os campos obrigatórios.', 'danger');
                return false;
            }

            const numerosCpfCnpj = cliente.cpfCnpj.replace(/\D/g, '');
            if (numerosCpfCnpj.length !== 11 && numerosCpfCnpj.length !== 14) {
                mostrarToast('Erro', 'CPF/CNPJ inválido', 'danger');
                return false;
            }

            if (clienteId) {
                await db.clientes.update(parseInt(clienteId), cliente);
            } else {
                await db.clientes.add(cliente);
            }

            $('#modalCliente').modal('hide');
            carregarClientes();
            mostrarToast('Sucesso', `Cliente ${clienteId ? 'atualizado' : 'cadastrado'} com sucesso!`, 'success');
            return false;
        } catch (error) {
            console.error('Erro ao salvar cliente:', error);
            mostrarToast('Erro', 'Não foi possível salvar o cliente.', 'danger');
            return false;
        }
    });

    // Evento quando o modal é aberto
    $('#modalCliente').on('show.bs.modal', function() {
        const valor = $('#cpfCnpjCliente').val().replace(/\D/g, '');
        if (valor.length > 11) {
            $('#cpfCnpjCliente').mask('00.000.000/0000-00');
        } else {
            $('#cpfCnpjCliente').mask('000.000.000-00');
        }
    });

    // Limpar formulário quando o modal for fechado
    $('#modalCliente').on('hidden.bs.modal', function() {
        $('#formCliente')[0].reset();
        $('#clienteId').val('');
    });
}

  





    // Função para carregar os dados da empresa do IndexedDB
    function carregarEmpresa() {
        db.empresa.get(1).then(function(empresa) {
            if (empresa) {
                $('#nomeEmpresa').val(empresa.nome);
                $('#cnpjEmpresa').val(empresa.cnpj);
                $('#cpfEmpresa').val(empresa.cpf);
                $('#whatsappEmpresa').val(empresa.whatsapp);
                $('#emailEmpresa').val(empresa.email);
                $('#cepEmpresa').val(empresa.cep);
                $('#cidadeEmpresa').val(empresa.cidade);
                $('#bairroEmpresa').val(empresa.bairro);
                $('#ruaEmpresa').val(empresa.rua);
                $('#numeroEmpresa').val(empresa.numero);

                // Aplica a cor do tema se estiver definida
                if (empresa.corTema) {
                    selectedColor = empresa.corTema;
                    aplicarCorTema(empresa.corTema);
                    $('.color-swatch').each(function() {
                        if ($(this).data('color') === empresa.corTema) {
                            $(this).addClass('selected');
                        }
                    });
                }

                // Exibe o logotipo se estiver definido
                if (empresa.logo) {
                    logoBase64 = empresa.logo;
                    exibirLogo(empresa.logo);
                }

                // Atualiza as informações da empresa no cabeçalho e no menu lateral
                atualizarInformacoesEmpresa(empresa);
            }
        }).catch(function(err) {
            console.error(err);
            mostrarToast('Erro', 'Erro ao carregar os dados da empresa.', 'danger');
        });
    }

    // Função para aplicar a cor do tema
    function aplicarCorTema(cor) {
        document.documentElement.style.setProperty('--primary-color', cor);
    }

    // Evento de clique na paleta de cores
    $(document).on('click', '.color-swatch', function() {
        $('.color-swatch').removeClass('selected');
        $(this).addClass('selected');
        selectedColor = $(this).data('color');
        aplicarCorTema(selectedColor);
    });

    // Função para atualizar as informações da empresa no cabeçalho e no menu lateral
    function atualizarInformacoesEmpresa(empresa) {
        if (empresa.nome) {
            $('#nomeEmpresaHeader').text(empresa.nome);
            $('#nomeEmpresaSidebar').text(empresa.nome);
        } else {
            $('#nomeEmpresaHeader').text('CarFilm-Pro');
            $('#nomeEmpresaSidebar').text('CarFilm-Pro');
        }

        if (empresa.cnpj || empresa.cpf) {
            var documento = empresa.cnpj ? 'CNPJ: ' + empresa.cnpj : 'CPF: ' + empresa.cpf;
            $('#cnpjEmpresaHeader').text(documento);
            $('#cnpjEmpresaSidebar').text(documento);
            $('#companyInfoHeader').addClass('visible');
        } else {
            $('#cnpjEmpresaHeader').text('');
            $('#cnpjEmpresaSidebar').text('');
            $('#companyInfoHeader').removeClass('visible');
        }

        if (empresa.logo) {
            $('#logoEmpresaHeader img').attr('src', empresa.logo);
            $('#logoEmpresaSidebar').attr('src', empresa.logo);
        } else {
            $('#logoEmpresaHeader img').attr('src', 'https://via.placeholder.com/40');
            $('#logoEmpresaSidebar').attr('src', 'https://via.placeholder.com/80');
        }
    }

    // Função para exibir o logotipo da empresa na pré-visualização
    function exibirLogo(logo) {
        $('#previewLogo img').attr('src', logo);
    }

    // Evento de mudança no input de upload do logotipo
    $('#logoEmpresa').on('change', function(event) {
        var file = event.target.files[0];
        if (file && file.type.match('image.*')) {
            var reader = new FileReader();
            reader.onload = function(e) {
                logoBase64 = e.target.result;
                exibirLogo(logoBase64);
            };
            reader.readAsDataURL(file);
        } else {
            mostrarToast('Erro', 'Por favor, selecione um arquivo de imagem válido.', 'danger');
        }
    });

    // Evento de fechamento do modalCadastrarFilme para resetar o formulário
    $('#modalCadastrarFilme').on('hidden.bs.modal', function () {
        $('#formCadastrarFilme')[0].reset(); // Limpa os campos do formulário
        $('#filmeId').val(''); // Reseta o campo oculto
        $('#modalCadastrarFilmeLabel').text('Cadastrar Película'); // Reseta o título do modal
        // Reconfigurar o formulário para adicionar novas películas
        $('#formCadastrarFilme').off('submit').on('submit', salvarFilme);
    });

    // Inicialização ao carregar a página
    $(document).ready(function() {
        carregarEmpresa();

        // Aplicação de máscaras nos inputs
        $('#cnpjEmpresa').mask('00.000.000/0000-00', {reverse: true});
        $('#cpfEmpresa').mask('000.000.000-00', {reverse: true});
        $('#whatsappEmpresa').mask('(00) 00000-0000');
        $('#cepEmpresa').mask('00000-000');

        // Ajustar a altura do conteúdo principal
        ajustarAlturaConteudo();
        $(window).resize(function() {
            ajustarAlturaConteudo();
        });

        // Exibir as categorias de películas com contadores
        listarCategoriasComContadores();

        // Configurar o evento de submissão do formulário de cadastro de película
        $('#formCadastrarFilme').on('submit', salvarFilme);

         // Inicializar componentes de clientes
    inicializarComponentesClientes();
    });

    // Função para ajustar a altura do conteúdo principal dinamicamente
    function ajustarAlturaConteudo() {
        var alturaJanela = $(window).height();
        var alturaHeader = $('.header').outerHeight();
        $('#mainContent').css('min-height', alturaJanela - alturaHeader);
    }

    // Variáveis globais e funções para "Clientes"
    // ... (todo o código JavaScript relacionado à seção "Clientes") ...


</script>
<script>
    function mostrarToast(titulo, mensagem, tipo = 'info') {
        $('#toastTitle').text(titulo);
        $('#toastBody').text(mensagem);

        // Ajustar a cor do cabeçalho do Toast com base no tipo
        $('#feedbackToast .toast-header').removeClass('bg-success bg-danger bg-info text-white');
        if (tipo === 'success') {
            $('#feedbackToast .toast-header').addClass('bg-success text-white');
        } else if (tipo === 'danger') {
            $('#feedbackToast .toast-header').addClass('bg-danger text-white');
        } else {
            $('#feedbackToast .toast-header').addClass('bg-info text-white');
        }

        $('#feedbackToast').toast('show');
    }
</script>

<script src="servicos.js"></script>
<script src="peliculas.js"></script> 


</body>
</html>
